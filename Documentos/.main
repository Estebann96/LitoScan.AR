from picamera2 import Picamera2
import time
import smbus

# Direcci칩n I2C del enfoque autom치tico
AF_I2C_ADDR = 0x0c
bus = smbus.SMBus(1)

# Enviar posici칩n al motor de enfoque
def set_focus(value):
    value = int(value)
    data1 = (value >> 8) & 0x3F
    data2 = value & 0xFF
    bus.write_i2c_block_data(AF_I2C_ADDR, 0x00, [data1, data2])
    print(f"Focus set to {value}")

# Inicializar c치mara
picam2 = Picamera2()
picam2.preview_configuration.main.size = (640, 480)
picam2.preview_configuration.main.format = "RGB888"
picam2.configure("preview")
picam2.start()
time.sleep(2)

# Bucle para probar enfoque manualmente
for focus_value in range(100, 1000, 100):
    set_focus(focus_value)
    time.sleep(1)

# Capturar imagen final
picam2.capture_file("autofocus_test.jpg")
print("Imagen capturada.")
